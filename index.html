<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Atkinson-dither</title>
  <script type="text/javascript" charset="utf-8">
    function draw() {
      var canvas = document.getElementById('canvas');
      if (canvas.getContext) {
        var ctx = canvas.getContext('2d'),
            colorimage = new Image();
        
        colorimage.src = "avatar.png";
        colorimage.onload = function() {
         ctx.drawImage(colorimage,0,0); 
         var imgd = ctx.getImageData(0,0,255,255); // FIXME: magic number
         var pixels = imgd.data;
         for (var i=0; i<=pixels.length; i+=4) {
         // luminance: red x 0.3 + green x 0.59 + blue x 0.11
          var grayscale = pixels[i] * 0.3 + pixels[i+1] * 0.59 + pixels[i+2] * 0.11;
          pixels[i] = pixels[i+1] = pixels[i+2] = grayscale;
         }
         ctx.putImageData(imgd,0,0);
        }
      }
    }
  </script>
  <style type="text/css" media="screen">
    canvas { border: 1px solid black; }
  </style>
</head>
<body onload="draw()">
  <canvas id="canvas" width="256" height="256"></canvas>
</body>
</html>
